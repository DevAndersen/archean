@inject JSInterop JSInterop

<dialog @ref="_dialogRef">
    @if (IsOpen)
    {
        <InterfacePanel Title="@Title">
            @ChildContent
        </InterfacePanel>
    }
</dialog>

@code
{
    private ElementReference _dialogRef;
    private bool _isOpen;

    /// <summary>
    /// The title of the dialog.
    /// </summary>
    [Parameter, EditorRequired]
    public required string Title { get; init; }

    /// <summary>
    /// Used to set if the dialog should be open (visible) or closed (invisible).
    /// </summary>
    [Parameter]
    public bool IsOpen { get; set; }

    /// <summary>
    /// The content of the dialog.
    /// </summary>
    [Parameter]
    public RenderFragment? ChildContent { get; init; }

    /// <summary>
    /// Opens the dialog and triggers element re-rendering.
    /// </summary>
    /// <returns></returns>
    private async Task OpenAsync()
    {
        if (!_isOpen)
        {
            await JSInterop.OpenDialogAsync(_dialogRef);
            IsOpen = true;
        }
    }

    /// <summary>
    /// Closes the dialog and triggers element re-rendering.
    /// </summary>
    /// <returns></returns>
    private async Task CloseAsync()
    {
        if (_isOpen)
        {
            await JSInterop.CloseDialogAsync(_dialogRef);
            IsOpen = false;
        }
    }

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (IsOpen != _isOpen)
        {
            if (IsOpen)
            {
                await OpenAsync();
            }
            else
            {
                await CloseAsync();
            }
            _isOpen = IsOpen;
        }
    }
}
